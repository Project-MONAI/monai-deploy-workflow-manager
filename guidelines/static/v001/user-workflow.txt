# Created at https://sequencediagram.org/
title Workload Manager v0.0.1 (User workflow)

actor User

participant CLI
participant "Informatics Gateway" as IG
participantgroup Workload Manager Core
participant "Export API" as Export
database "MWM Database" as WMDB
fontawesome f0a0 "Storage" as Storage
end

participantgroup Orchestration Mediator Service
participant "App Registration API" as ARA
participant "Orchestration Mediator API" as OMA
participant "Argo Plugin" as ARP
database "Database" as OESDB
end

participantgroup Third Party
participant Docker
participant Argo
participant #lightgray "App Server" as APPSVR
end

note over APPSVR:*future*

activate User
User->User: Compose Argo workflow
User->Docker: Deploys Docker containers via Docker CLI

group Register Application Workflow
User->CLI: Register application
activate CLI
CLI->ARA: Step 1. Deploy workflow
activate ARA

ARA->ARA: Validate registration request

group Orchestration Engine Validation
ARA->OMA: Validate
activate OMA
OMA->ARP: Validate
activate ARP
ARP->Argo: Validate (if needed)
OMA<--ARP: Response
deactivate ARP
ARA<--OMA: Response
end
deactivate OMA
ARA->OESDB: Save
CLI<--ARA: Response
deactivate ARA

CLI->Export: Step 2. Register sink
Export->Export: Validate
Export->WMDB: Create & save sink
CLI<--Export: Response

CLI->IG: Step 3. Create AET-App mapping
CLI<--IG: Response
User<--CLI: Response
deactivate CLI
deactivate User

end
